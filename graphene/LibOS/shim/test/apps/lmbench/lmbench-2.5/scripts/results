#!/bin/sh

# $Id$

if [ -z "$OS" ]; then
	OS=`../scripts/os`
fi
if [ -z "$CONFIG" ]; then
	CONFIG=`../scripts/config`
fi
if [ -z "$RESULTS" ]; then
	RESULTS=results/$OS
fi
BASE=../$RESULTS/`uname -n`
EXT=0

if [ ! -f "../bin/$OS/$CONFIG" ]
then	echo "No config file?"
	exit 1
fi
. ../bin/$OS/$CONFIG

if [ ! -d ../$RESULTS ]
then	mkdir -p ../$RESULTS
fi
RESULTS=$BASE.$EXT
while [ -f $RESULTS ]
do      EXT=`expr $EXT + 1`
	RESULTS=$BASE.$EXT
done

cd ../bin/$OS 
export OUTPUT
echo Results going to ${RESULTS}
./lmbench $CONFIG 2>../${RESULTS}

if [ X$MAIL = Xyes ]
then	(echo Mailing results
	echo ---- $INFO ---
	cat $INFO 
	echo ---- $RESULTS ---
	cat ../$RESULTS) | mail lmbench2@bitmover.com 
fi
exit 0
